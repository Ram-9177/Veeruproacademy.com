{% load i18n static %}
{% get_current_language as CURRENT_LANGUAGE %}

<!DOCTYPE html>
<html lang="{{ CURRENT_LANGUAGE|default:'en' }}" class="scroll-smooth dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="{% block meta_description %}Veeru's Pro Academy - Master programming, web development, and tech skills with expert-led courses{% endblock %}">
  <meta name="keywords" content="programming courses, web development, Python, JavaScript, React, online learning, coding bootcamp">
  <meta name="author" content="Veeru's Pro Academy">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#181A20">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- Open Graph -->
  <meta property="og:title" content="{% block og_title %}Veeru's Pro Academy{% endblock %}">
  <meta property="og:description" content="Master programming and web development with expert-led courses">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:image" content="{% block og_image %}https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=1200&h=630&fit=crop{% endblock %}">
  <meta property="og:site_name" content="Veeru's Pro Academy">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% block twitter_title %}Veeru's Pro Academy{% endblock %}">
  <meta name="twitter:description" content="Master programming and web development with expert-led courses">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{% static 'branding/favicon.png' %}">
  <link rel="apple-touch-icon" href="{% static 'branding/favicon.png' %}">
  <link rel="shortcut icon" href="{% static 'branding/favicon.png' %}">
  
  <!-- Preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  
  <title>{% block title %}Veeru's Pro Academy{% endblock %}</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: {
              primary: '#5A9CB5',
              accent: '#FACE68',
              orange: '#FAAC68',
              red: '#FA6868',
              blue: '#5A9CB5',
              yellow: '#FACE68',
              dark: '#181A20',
              card: '#23272F',
            },
            dark: {
              900: '#181A20',
              800: '#23272F',
              700: '#2D4059',
            },
            sand: '#FAAC68',
            coral: '#FA6868',
            dark: '#232946',
            primary: {
              500: '#5A9CB5',
              600: '#FACE68',
              700: '#FAAC68',
              800: '#FA6868',
            },
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'slide-up': 'slideUp 0.5s ease-out',
            'bounce-slow': 'bounceSlow 3s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            bounceSlow: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-16px)' },
            },
          },
        }
      }
    }
  </script>
  <style>
    body, html {
      background: #0f1021 !important;
      color: #f5f5f5 !important;
    }
    .cyberpunk-glow {
      text-shadow: 0 0 8px #ff00cc, 0 0 16px #00fff7, 0 0 2px #fff;
    }
    .btn-primary {
      background: linear-gradient(90deg, #ff00cc 0%, #00fff7 100%);
      color: #0f1021;
      border: none;
      box-shadow: 0 0 16px #ff00cc99, 0 0 32px #00fff799;
      transition: box-shadow 0.2s, background 0.2s;
      font-weight: bold;
      letter-spacing: 0.05em;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #00fff7 0%, #ff00cc 100%);
      color: #0f1021;
      box-shadow: 0 0 32px #00fff799, 0 0 16px #ff00cc99;
    }
    .section-dark {
      background: #18132a !important;
      color: #f5f5f5 !important;
      border-top: 2px solid #ff00cc;
      border-bottom: 2px solid #00fff7;
    }
    .card {
      background: #1a1530 !important;
      color: #f5f5f5 !important;
      border: 2px solid #00fff7;
      box-shadow: 0 0 24px #ff00cc55, 0 0 8px #00fff755;
    }
    .card-accent {
      border-color: #ff00cc !important;
    }
    .text-brand-accent { color: #ff00cc !important; }
    .text-brand-blue { color: #00fff7 !important; }
    .text-brand-orange { color: #fffb00 !important; }
    .text-brand-red { color: #ff003c !important; }
    .bg-brand-dark { background: #0f1021 !important; }
    .bg-brand-card { background: #1a1530 !important; }
    .bg-brand-accent { background: #ff00cc !important; }
    .bg-brand-blue { background: #00fff7 !important; }
    .bg-brand-orange { background: #fffb00 !important; }
    .bg-brand-red { background: #ff003c !important; }
    .shadow-brand { box-shadow: 0 0 16px #ff00cc99, 0 0 32px #00fff799; }
    .shadow-accent { box-shadow: 0 0 16px #ff00cc99; }
    .shadow-orange { box-shadow: 0 0 16px #fffb0099; }
    .shadow-red { box-shadow: 0 0 16px #ff003c99; }
    a, .link {
      color: #00fff7;
      text-shadow: 0 0 4px #ff00cc99;
      transition: color 0.2s;
    }
    a:hover, .link:hover {
      color: #ff00cc;
      text-shadow: 0 0 8px #00fff799;
    }
    .cyberpunk-border {
      border: 2px solid #ff00cc;
      box-shadow: 0 0 8px #ff00cc, 0 0 16px #00fff7;
    }
    .cyberpunk-bg {
      background: linear-gradient(135deg, #0f1021 60%, #1a1530 100%);
    }
    .cyberpunk-neon {
      color: #ff00cc;
      text-shadow: 0 0 8px #ff00cc, 0 0 16px #00fff7;
    }
  </style>
              sand: '#FAAC68',
              coral: '#FA6868',
              dark: '#232946',
            },
            primary: {
              500: '#5A9CB5',
              600: '#FACE68',
              700: '#FAAC68',
              800: '#FA6868',
            },
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'slide-up': 'slideUp 0.5s ease-out',
            'bounce-slow': 'bounceSlow 3s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            bounceSlow: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-16px)' },
            },
          },
        }
      }
    }
  </script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Space Grotesk', 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; position: relative; overflow-x: hidden; }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(120deg, rgba(255, 106, 61, 0.08) 0%, rgba(26, 34, 56, 0.95) 100%),
        radial-gradient(circle at 10% 20%, rgba(255, 212, 96, 0.12), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(255, 106, 61, 0.10), transparent 35%),
        radial-gradient(circle at 50% 100%, rgba(35, 41, 70, 0.15), transparent 45%);
      opacity: 0.9;
      pointer-events: none;
      z-index: -2;
      mix-blend-mode: screen;
      background-attachment: fixed;
    }
    html.dark body::before {
      opacity: 0.95;
      mix-blend-mode: overlay;
      background-image:
        linear-gradient(120deg, rgba(35, 41, 70, 0.98) 0%, rgba(255, 106, 61, 0.12) 100%),
        radial-gradient(circle at 10% 20%, rgba(255, 106, 61, 0.10), transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(255, 212, 96, 0.10), transparent 35%),
        radial-gradient(circle at 50% 100%, rgba(26, 34, 56, 0.15), transparent 45%);
    }
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2Fsvg%22%20width%3D%22120%22%20height%3D%22120%22%20viewBox%3D%220%200%20120%20120%22%3E%3Cpath%20d%3D%22M0%20120L120%200%22%20stroke%3D%22%23FF6A3D%22%20stroke-width%3D%221%22%2F%3E%3C%2Fsvg%3E");
      opacity: 0.12;
      mix-blend-mode: soft-light;
      pointer-events: none;
      z-index: -1;
      background-attachment: fixed;
    }
    html.dark body::after {
      opacity: 0.09;
      mix-blend-mode: multiply;
    }
    .texture-layer {
      position: relative;
      overflow: hidden;
    }
    .texture-layer::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 45%),
        repeating-linear-gradient(120deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.18) 1px, transparent 1px, transparent 12px);
      opacity: 0.25;
      pointer-events: none;
      z-index: 0;
      mix-blend-mode: screen;
    }
    .texture-layer > * {
      position: relative;
      z-index: 1;
    }
    .textured-panel {
      background-color: rgba(255, 255, 255, 0.9);
      background-image:
        linear-gradient(135deg, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 255, 0) 60%),
        repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.08) 1px, transparent 1px, transparent 6px);
      border: 1px solid rgba(15, 23, 42, 0.08);
      box-shadow: 0 25px 45px -25px rgba(15, 23, 42, 0.45);
      backdrop-filter: blur(8px);
    }
    .dark .textured-panel {
      background-color: rgba(15, 23, 42, 0.7);
      border-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 35px -20px rgba(0, 0, 0, 0.6);
    }
    .flow-section {
      position: relative;
      overflow: hidden;
    }
    .flow-section::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0px, transparent 60%);
      opacity: 0.35;
      z-index: 0;
    }
    .flow-section > * {
      position: relative;
      z-index: 1;
    }
    .flow-section h2, .flow-section h3 {
      color: #FACE68;
    }
    .btn-primary {
      background: #5A9CB5;
      color: #232946;
      border: 1px solid #FACE68;
      box-shadow: 0 18px 40px -18px rgba(90, 156, 181, 0.65);
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      background: #FAAC68;
      color: #232946;
      transform: translateY(-1px);
    }
    .btn-secondary {
      background: transparent;
      color: #576A8F;
      border: 1px solid rgba(87, 106, 143, 0.4);
      transition: all 0.2s ease;
    }
    .btn-secondary:hover {
      border-color: #576A8F;
      background: rgba(87, 106, 143, 0.08);
    }
    .flow-steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.25rem;
    }
    .flow-step {
      padding: 1.75rem;
      border-radius: 1.25rem;
      border: 1px solid rgba(255, 255, 255, 0.25);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      background: rgba(255, 255, 255, 0.08);
    }
    .flow-step:hover, .flow-step:focus-within {
      transform: translateY(-4px);
      box-shadow: 0 15px 35px -20px rgba(15, 23, 42, 0.8);
      border-color: rgba(255, 255, 255, 0.7);
    }
    .flow-step-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.4);
      margin-bottom: 1rem;
      color: white;
    }
    .flow-step p {
      color: rgba(255, 255, 255, 0.85);
    }
    
    /* Theme Colors - Flat Solid Fills (aligned to Tailwind config) */
    .bg-brand-primary { background-color: #2D4059; }
    .bg-brand-accent { background-color: #EA5455; }
    .bg-brand-orange { background-color: #F07B3F; }
    .bg-brand-blue { background-color: #2D4059; }
    .bg-brand-dark { background-color: #1E2C3E; }
    .bg-brand-cream { background-color: #FFD460; }
    .bg-brand-subtle { background-color: #2D4059; }
    .bg-brand-black { background-color: #000000; }
    
    .text-brand-primary { color: #2D4059; }
    .text-brand-accent { color: #EA5455; }
    .text-brand-orange { color: #F07B3F; }
    .text-brand-blue { color: #2D4059; }
    .text-brand-dark { color: #1E2C3E; }
    .text-brand-cream { color: #FFD460; }
    .text-brand-subtle { color: #2D4059; }
    
    .border-brand-primary { border-color: #2D4059; }
    .border-brand-accent { border-color: #EA5455; }
    .border-brand-orange { border-color: #F07B3F; }
    .border-brand-blue { border-color: #2D4059; }
    
    /* Primary Button - Accent */
    .btn-primary {
      background-color: #EA5455;
      color: white;
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      background-color: #D33F45;
      box-shadow: 0 4px 12px rgba(234, 84, 85, 0.3);
      transform: translateY(-2px);
    }
    .btn-primary:focus {
      outline: 2px solid #EA5455;
      outline-offset: 2px;
    }
    .btn-primary:active {
      background-color: #C43B3C;
      transform: translateY(0);
    }
    .btn-primary:disabled {
      background-color: #94a3b8;
      cursor: not-allowed;
      box-shadow: none;
    }
    
    /* Secondary Button - Primary */
    .btn-secondary {
      background-color: #2D4059;
      color: white;
      transition: all 0.2s ease;
    }
    .btn-secondary:hover {
      background-color: #25364B;
      box-shadow: 0 4px 12px rgba(45, 64, 89, 0.3);
      transform: translateY(-2px);
    }
    .btn-secondary:focus {
      outline: 2px solid #2D4059;
      outline-offset: 2px;
    }
    .btn-secondary:active {
      transform: translateY(0);
    }
    
    /* Outline Button */
    .btn-outline {
      background-color: transparent;
      border: 2px solid #2D4059;
      color: #2D4059;
      transition: all 0.2s ease;
    }
    .btn-outline:hover {
      background-color: rgba(45, 64, 89, 0.1);
      border-color: #25364B;
      color: #25364B;
    }
    .btn-outline:focus {
      outline: 2px solid #2D4059;
      outline-offset: 2px;
    }
    .dark .btn-outline {
      border-color: #EA5455;
      color: #EA5455;
    }
    .dark .btn-outline:hover {
      background-color: rgba(234, 84, 85, 0.1);
      border-color: #D33F45;
      color: #D33F45;
    }
    
    /* Card Hover Effect */
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15);
    }
    .dark .card-hover:hover { 
      box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.4);
    }
    
    /* Hero Section */
    .hero-bg { background: linear-gradient(135deg, #576A8F 0%, #4A5D81 100%); }
    .dark .hero-bg { background: linear-gradient(135deg, #3C4C6B 0%, #2F3D58 100%); }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    .dark ::-webkit-scrollbar-track { background: #2F3D58; }
    ::-webkit-scrollbar-thumb { background: #B7BDF7; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #576A8F; }
    
    /* Focus States */
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible { 
      outline: 2px solid #FF7444; 
      outline-offset: 2px; 
    }
    
    /* Line Clamp */
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    
    /* Loading States */
    .spinner { border: 3px solid #e5e7eb; border-top-color: #FF7444; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .btn-loading { position: relative; color: transparent !important; pointer-events: none; }
    .btn-loading::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 2px solid white; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; }
    
    /* Page Transition */
    .page-enter { animation: fadeIn 0.3s ease-out; }
    
    /* Form Input Focus */
    input:focus, select:focus, textarea:focus {
      border-color: #FF7444;
      box-shadow: 0 0 0 3px rgba(255, 116, 68, 0.1);
    }
    
    /* Link Styles */
    .link-primary { color: #FF7444; transition: color 0.2s; }
    .link-primary:hover { color: #FF6238; }
    .dark .link-primary { color: #FF8555; }
    .dark .link-primary:hover { color: #FF7444; }
    
    /* Navigation Active State */
    .nav-link.active {
      background-color: white;
      color: #FF7444;
      font-weight: 600;
    }
    .dark .nav-link.active {
      background-color: #3C4C6B;
      color: #FF7444;
    }
    
    /* Consistent Button Heights */
    .btn-h-10 { height: 40px; display: inline-flex; align-items: center; justify-content: center; }
    
    /* Sticky Courses Bar - Hide scrollbar */
    #coursesBarList::-webkit-scrollbar { display: none; }
    #coursesBarList { -ms-overflow-style: none; }
  </style>
  
  <!-- Dark mode init -->
  <script>
    (function() {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
  
  {% block extra_head %}{% endblock %}
</head>
<body class="bg-brand-primary text-gray-900 dark:bg-brand-dark dark:text-gray-100 min-h-screen flex flex-col page-enter">
  <!-- Skip to content -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 btn-primary px-4 py-2 rounded-lg z-[100]">Skip to main content</a>

  <!-- Navigation -->
  <nav class="bg-white dark:bg-dark-900 shadow-md sticky top-0 z-50 border-b border-gray-200 dark:border-dark-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <!-- Logo -->
        <div class="flex items-center">
          <a href="{% url 'academy_web:home' %}" class="flex items-center space-x-2 group" aria-label="Veeru's Pro Academy Home">
            <div class="w-12 h-12 rounded-xl flex items-center justify-center shadow-md overflow-hidden bg-white dark:bg-dark-700 border border-gray-200 dark:border-gray-700">
              <img src="{% static 'branding/logo-dark-bg.png' %}" alt="Veeru's Pro Academy Logo" class="w-full h-full object-contain dark:block hidden"/>
              <img src="{% static 'branding/logo-white-bg.png' %}" alt="Veeru's Pro Academy Logo" class="w-full h-full object-contain dark:hidden"/>
            </div>
            <span class="font-bold text-xl text-gray-900 dark:text-white hidden sm:block tracking-tight">Veeru's <span class="text-brand-orange">Pro Academy</span></span>
          </a>
        </div>
        
        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center">
          <div class="flex items-center bg-gray-100 dark:bg-dark-700 rounded-xl p-1">
            <a href="{% url 'academy_web:home' %}" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">Home</a>
            <!-- Courses Dropdown -->
            <div class="relative group">
              <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap flex items-center" onclick="toggleCoursesDropdown(event)">
                Courses
                <i class="fas fa-chevron-down text-xs ml-1.5 group-hover:rotate-180 transition-transform"></i>
              </button>
              <!-- Dropdown Menu -->
              <div id="coursesDropdown" class="absolute top-full left-0 mt-1 w-64 bg-white dark:bg-dark-700 rounded-xl shadow-lg border border-gray-200 dark:border-dark-600 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 max-h-96 overflow-y-auto z-50">
                <div class="p-2">
                  <a href="{% url 'academy_web:course_list' %}" class="block px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-600 hover:text-brand-orange transition-all">
                    View All Courses
                  </a>
                  <div class="border-t border-gray-200 dark:border-dark-600 my-2"></div>
                  <div id="coursesList" class="space-y-1">
                    <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400">Loading courses...</div>
                  </div>
                </div>
              </div>
            </div>
            <a href="{% url 'academy_web:projects_list' %}" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">Projects</a>
            <a href="{% url 'academy_web:blog' %}" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">Blog</a>
            <a href="{% url 'academy_web:about' %}" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">About</a>
            <a href="{% url 'academy_web:contact' %}" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">Contact</a>
          </div>
          {% if request.user.is_authenticated %}
          <div class="flex items-center ml-2 bg-gray-100 dark:bg-dark-700 rounded-xl p-1">
            <a href="{% url 'academy_web:dashboard' %}" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">Dashboard</a>
            {% if request.user.is_staff %}
            <a href="/admin/" class="nav-link px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-white dark:hover:bg-dark-600 transition-all whitespace-nowrap">Admin</a>
            <style>
              body { font-family: 'Space Grotesk', 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; position: relative; overflow-x: hidden; }
              body::before {
                content: "";
                position: fixed;
                inset: 0;
                background-image:
                  radial-gradient(circle at 10% 20%, rgba(45, 64, 89, 0.25), transparent 55%),
                  radial-gradient(circle at 80% 0%, rgba(234, 84, 85, 0.12), transparent 35%),
                  radial-gradient(circle at 50% 100%, rgba(240, 123, 63, 0.10), transparent 45%);
                opacity: 0.7;
                pointer-events: none;
                z-index: -2;
                mix-blend-mode: screen;
                background-attachment: fixed;
              }
              html.dark body::before {
                opacity: 0.55;
                mix-blend-mode: overlay;
              }
              body::after {
                content: "";
                position: fixed;
                inset: 0;
                background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22120%22%20height%3D%22120%22%20viewBox%3D%220%200%20120%20120%22%3E%3Cpath%20d%3D%22M0%20120L120%200%22%20stroke%3D%22%232d4059%22%20stroke-width%3D%221%22%2F%3E%3C%2Fsvg%3E");
                opacity: 0.09;
                mix-blend-mode: soft-light;
                pointer-events: none;
                z-index: -1;
                background-attachment: fixed;
              }
              html.dark body::after {
                opacity: 0.07;
                mix-blend-mode: multiply;
              }
                <i class="fas fa-sign-out-alt"></i>
              </a>
            {% endif %}
            </div>
            {% endif %}
          {% else %}
            <div class="flex items-center space-x-2 pl-2 ml-2 border-l border-gray-200 dark:border-dark-600">
              <a href="{% url 'academy_web:login' %}" class="h-10 px-4 rounded-xl text-gray-700 dark:text-gray-300 hover:text-brand-orange hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all text-sm flex items-center justify-center">Login</a>
              <a href="{% url 'academy_web:signup' %}" class="h-10 btn-primary px-5 rounded-xl font-medium text-sm flex items-center justify-center shadow-md">Sign Up</a>
            </div>
          {% endif %}
        </div>
        
        <!-- Mobile/Tablet buttons -->
        <div class="lg:hidden flex items-center space-x-2">
          <button type="button" onclick="toggleDarkMode()" class="w-10 h-10 rounded-xl bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-gray-300 flex items-center justify-center" aria-label="Toggle dark mode">
            <i class="fas fa-sun dark:hidden"></i>
            <i class="fas fa-moon hidden dark:block"></i>
          </button>
          <button type="button" onclick="toggleMobileMenu()" class="w-10 h-10 rounded-xl bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-gray-300 flex items-center justify-center" aria-label="Toggle menu">
            <i class="fas fa-bars text-lg" id="menu-icon"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden lg:hidden bg-white dark:bg-dark-800 border-t border-gray-200 dark:border-dark-700">
      <div class="px-4 py-4 space-y-1">
        <a href="{% url 'academy_web:home' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
          <i class="fas fa-home mr-3 w-5 text-center text-brand-orange"></i>Home
        </a>
        <a href="{% url 'academy_web:course_list' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
          <i class="fas fa-book mr-3 w-5 text-center text-brand-orange"></i>Courses
        </a>
        <a href="{% url 'academy_web:projects_list' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
          <i class="fas fa-project-diagram mr-3 w-5 text-center text-brand-orange"></i>BTech Projects
        </a>
        <a href="{% url 'academy_web:blog' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
          <i class="fas fa-blog mr-3 w-5 text-center text-brand-orange"></i>Blog
        </a>
        <a href="{% url 'academy_web:about' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
          <i class="fas fa-info-circle mr-3 w-5 text-center text-brand-orange"></i>About
        </a>
        <a href="{% url 'academy_web:contact' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
          <i class="fas fa-envelope mr-3 w-5 text-center text-brand-orange"></i>Contact
        </a>
        {% if request.user.is_authenticated %}
          <a href="{% url 'academy_web:dashboard' %}" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
            <i class="fas fa-tachometer-alt mr-3 w-5 text-center text-brand-orange"></i>Dashboard
          </a>
          {% if request.user.is_staff %}
            <a href="/admin/" class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-700 font-medium transition-all">
              <i class="fas fa-cog mr-3 w-5 text-center text-brand-orange"></i>Admin Panel
            </a>
          {% endif %}
          <div class="border-t border-gray-200 dark:border-dark-700 pt-4 mt-4">
            <div class="flex items-center px-4 py-2 mb-3">
              <div class="w-10 h-10 bg-brand-blue rounded-full flex items-center justify-center mr-3">
                <span class="text-white font-bold">{{ request.user.name|default:request.user.email|slice:":1"|upper }}</span>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-900 dark:text-white">{{ request.user.name|default:"User" }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">{{ request.user.email }}</div>
              </div>
            </div>
            <a href="{% url 'academy_web:logout' %}" onclick="return confirm('Are you sure you want to logout?')" class="flex items-center justify-center bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-4 py-3 rounded-xl font-medium hover:bg-red-100 dark:hover:bg-red-900/50 transition-all">
              <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
          </div>
        {% else %}
          <div class="border-t border-gray-200 dark:border-dark-700 pt-4 mt-4 space-y-2">
            <a href="{% url 'academy_web:login' %}" class="flex items-center justify-center border-2 border-brand-blue text-brand-blue dark:border-brand-orange dark:text-brand-orange px-4 py-3 rounded-xl font-medium hover:bg-brand-blue hover:text-white dark:hover:bg-brand-orange dark:hover:text-white transition-all">
              <i class="fas fa-sign-in-alt mr-2"></i>Login
            </a>
            <a href="{% url 'academy_web:signup' %}" class="flex items-center justify-center btn-primary px-4 py-3 rounded-xl font-medium">
              <i class="fas fa-user-plus mr-2"></i>Sign Up Free
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </nav>
  
  <!-- Sticky Courses Bar -->
  <div id="coursesBar" class="bg-white dark:bg-dark-900 border-b border-gray-200 dark:border-dark-700 sticky top-16 z-40 shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex items-center space-x-2">
        <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 whitespace-nowrap">Featured:</span>
        <div id="coursesBarList" class="flex items-center space-x-2 overflow-x-auto pb-1" style="scrollbar-width: none; -ms-overflow-style: none;">
          <!-- Courses will be loaded here by JavaScript -->
          <div class="text-xs text-gray-500 dark:text-gray-400">Loading courses...</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Flash Messages -->
  {% if messages %}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4 space-y-2" role="alert">
      {% for message in messages %}
        <div class="{% if message.tags == 'error' %}bg-red-50 dark:bg-red-900/30 border-red-500 text-red-700 dark:text-red-400{% elif message.tags == 'success' %}bg-green-50 dark:bg-green-900/30 border-green-500 text-green-700 dark:text-green-400{% elif message.tags == 'warning' %}bg-yellow-50 dark:bg-yellow-900/30 border-yellow-500 text-yellow-700 dark:text-yellow-400{% else %}bg-blue-50 dark:bg-blue-900/30 border-blue-500 text-blue-700 dark:text-blue-400{% endif %} border-l-4 rounded-lg p-4 flex items-center justify-between shadow-sm">
          <div class="flex items-center">
            <i class="{% if message.tags == 'error' %}fas fa-exclamation-circle{% elif message.tags == 'success' %}fas fa-check-circle{% elif message.tags == 'warning' %}fas fa-exclamation-triangle{% else %}fas fa-info-circle{% endif %} mr-3 text-lg"></i>
            <span class="font-medium">{{ message }}</span>
          </div>
          <button type="button" onclick="this.parentElement.remove()" class="ml-4 opacity-70 hover:opacity-100 transition-opacity" aria-label="Dismiss">
            <i class="fas fa-times"></i>
          </button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  <!-- Main Content -->
  <main id="main-content" class="flex-grow">
    {% block content %}{% endblock %}
  </main>
  
  <!-- Footer -->
  <footer class="bg-brand-dark text-white mt-auto">
    <!-- Premium Logo Section -->
    <div class="border-b border-white/10 py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
          <div class="text-center md:text-left">
            <h3 class="text-xl font-bold mb-2">Veeru's Pro Academy</h3>
            <p class="text-gray-400 text-sm">Your Checkmark for Professional Excellence</p>
          </div>
          <div class="flex justify-center">
            <span class="text-xl font-black text-brand-primary">VEERUPRO ACADEMY</span>
          </div>
          <div class="text-center md:text-right">
            <p class="text-gray-400 text-sm mb-2">Trusted by 5000+ learners</p>
            <div class="flex justify-center md:justify-end gap-2">
              <span class="inline-flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full text-xs"><i class="fas fa-star text-brand-orange"></i> Lifetime Access</span>
              <span class="inline-flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full text-xs"><i class="fas fa-shield-alt text-brand-orange"></i> Certified</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12">
        <!-- Brand -->
        <div class="lg:col-span-1">
          <div class="flex items-center space-x-2 mb-4">
            <div class="w-10 h-10 bg-brand-orange rounded-xl flex items-center justify-center">
              <i class="fas fa-graduation-cap text-white text-xl"></i>
            </div>
            <span class="font-bold text-lg">Veeru's Pro</span>
          </div>
          <p class="text-gray-400 mb-6 leading-relaxed text-sm">Empowering students with industry-ready skills through expert-led courses in programming and web development.</p>
          <div class="flex space-x-3">
            <a href="https://youtube.com" target="_blank" rel="noopener" class="w-10 h-10 bg-brand-blue rounded-xl flex items-center justify-center hover:bg-brand-orange transition-colors" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            <a href="https://instagram.com" target="_blank" rel="noopener" class="w-10 h-10 bg-brand-blue rounded-xl flex items-center justify-center hover:bg-brand-orange transition-colors" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://linkedin.com" target="_blank" rel="noopener" class="w-10 h-10 bg-brand-blue rounded-xl flex items-center justify-center hover:bg-brand-orange transition-colors" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://github.com" target="_blank" rel="noopener" class="w-10 h-10 bg-brand-blue rounded-xl flex items-center justify-center hover:bg-brand-orange transition-colors" aria-label="GitHub"><i class="fab fa-github"></i></a>
          </div>
        </div>
        
        <!-- Quick Links -->
        <div>
          <h4 class="font-semibold text-lg mb-4">Quick Links</h4>
          <ul class="space-y-3 text-gray-400">
            <li><a href="{% url 'academy_web:course_list' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>All Courses</a></li>
            <li><a href="{% url 'academy_web:projects_list' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>BTech Projects</a></li>
            <li><a href="{% url 'academy_web:blog' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>Blog</a></li>
            <li><a href="{% url 'academy_web:faq' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>FAQ</a></li>
            <li><a href="{% url 'academy_web:careers' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>Careers</a></li>
          </ul>
        </div>
        
        <!-- Legal -->
        <div>
          <h4 class="font-semibold text-lg mb-4">Legal</h4>
          <ul class="space-y-3 text-gray-400">
            <li><a href="{% url 'academy_web:about' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>About Us</a></li>
            <li><a href="{% url 'academy_web:contact' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>Contact Us</a></li>
            <li><a href="{% url 'academy_web:privacy' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>Privacy Policy</a></li>
            <li><a href="{% url 'academy_web:terms' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>Terms of Service</a></li>
            <li><a href="{% url 'academy_web:refund_policy' %}" class="hover:text-brand-orange transition-colors flex items-center"><i class="fas fa-chevron-right text-xs mr-2 text-brand-orange"></i>Refund Policy</a></li>
          </ul>
        </div>
        
        <!-- Contact -->
        <div>
          <h4 class="font-semibold text-lg mb-4">Contact Us</h4>
          <ul class="space-y-3 text-gray-400">
            <li class="flex items-start"><i class="fas fa-envelope mr-3 text-brand-orange mt-1"></i><a href="mailto:support@veeruproacademy.com" class="hover:text-white transition-colors">support@veeruproacademy.com</a></li>
            <li class="flex items-start"><i class="fas fa-globe mr-3 text-brand-orange mt-1"></i><a href="https://veeruproacademy.com" class="hover:text-white transition-colors">veeruproacademy.com</a></li>
            <li class="flex items-start"><i class="fas fa-map-marker-alt mr-3 text-brand-orange mt-1"></i><span>India</span></li>
          </ul>
          
          <!-- Newsletter -->
          <div class="mt-6">
            <h5 class="font-medium mb-2 text-white">Stay Updated</h5>
            <form class="flex" onsubmit="event.preventDefault(); this.querySelector('button').textContent = 'Subscribed!'; this.querySelector('input').disabled = true;">
              <input type="email" placeholder="Your email" required class="flex-1 bg-brand-blue border-0 rounded-l-lg px-4 py-2.5 text-sm text-white placeholder-gray-400 focus:ring-2 focus:ring-brand-orange">
              <button type="submit" class="btn-primary px-4 py-2.5 rounded-r-lg font-medium"><i class="fas fa-paper-plane"></i></button>
            </form>
          </div>
        </div>
      </div>
      
      <div class="border-t border-brand-blue mt-10 pt-8 flex flex-col md:flex-row justify-between items-center text-gray-400 text-sm">
        <p>&copy; {% now "Y" %} Veeru's Pro Academy. All rights reserved.</p>
        <p class="mt-2 md:mt-0">Made with <i class="fas fa-heart text-brand-orange mx-1"></i> in India</p>
      </div>
    </div>
  </footer>
  
  <!-- Back to Top -->
  <button type="button" id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="fixed bottom-6 right-6 w-12 h-12 btn-primary rounded-full shadow-lg flex items-center justify-center opacity-0 invisible transition-all z-40 hover:scale-110" aria-label="Back to top">
    <i class="fas fa-chevron-up"></i>
  </button>
  
  <script>
    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const icon = document.getElementById('menu-icon');
      menu.classList.toggle('hidden');
      icon.classList.toggle('fa-bars');
      icon.classList.toggle('fa-times');
    }
    
    function toggleDarkMode() {
      const html = document.documentElement;
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    }
    
    // Course dropdown functionality
    function toggleCoursesDropdown(e) {
      e.preventDefault();
      const dropdown = document.getElementById('coursesDropdown');
      dropdown.classList.toggle('opacity-0');
      dropdown.classList.toggle('invisible');
    }
    
    // Load courses into dropdown
    async function loadCoursesDropdown() {
      try {
        const response = await fetch('/api/courses/');
        const data = await response.json();
        const coursesList = document.getElementById('coursesList');
        const courses = Array.isArray(data) ? data : (data.results || []);
        
        if (courses.length > 0) {
          coursesList.innerHTML = courses.map(course => `
            <a href="/courses/${course.slug}/" class="block px-4 py-2.5 rounded-lg text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-600 hover:text-brand-orange transition-all">
              <div class="font-medium truncate">${course.title}</div>
              <div class="text-xs text-gray-500 dark:text-gray-400 truncate">${course.category || 'Course'}</div>
            </a>
          `).join('');
        } else {
          coursesList.innerHTML = '<div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400">No courses available</div>';
        }
      } catch (error) {
        const coursesList = document.getElementById('coursesList');
        coursesList.innerHTML = '<div class="px-4 py-2 text-xs text-red-500">Error loading courses</div>';
        console.error('Error loading courses:', error);
      }
    }
    
    // Load courses in sticky bar
    async function loadCoursesBar() {
      try {
        const response = await fetch('/api/courses/');
        const data = await response.json();
        
        const coursesBarList = document.getElementById('coursesBarList');
        const courses = Array.isArray(data) ? data : (data.results || []);
        
        if (courses.length > 0) {
          coursesBarList.innerHTML = courses.map(course => `
            <a href="/courses/${course.slug}/" class="inline-flex items-center px-4 py-1.5 rounded-full bg-white dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-brand-orange hover:text-white dark:hover:bg-brand-orange transition-all whitespace-nowrap shadow-sm">
              ${course.title}
            </a>
          `).join('');
        } else {
          coursesBarList.innerHTML = '<div class="text-xs text-gray-500 dark:text-gray-400">No courses available</div>';
        }
      } catch (error) {
        const coursesBarList = document.getElementById('coursesBarList');
        coursesBarList.innerHTML = '<div class="text-xs text-red-500">Error loading courses</div>';
        console.error('Error loading courses bar:', error);
      }
    }
    
    // Load courses on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadCoursesBar();
      loadCoursesDropdown();
    });

    function highlightActiveNav() {
      const normalizedPath = (window.location.pathname.replace(/\/$/, '') || '/');
      document.querySelectorAll('.nav-link').forEach(function(link) {
        try {
          const linkUrl = new URL(link.href, window.location.origin);
          const linkPath = (linkUrl.pathname.replace(/\/$/, '') || '/');
          if (linkPath === normalizedPath) {
            link.classList.add('active');
          } else {
            link.classList.remove('active');
          }
        } catch (error) {
          // Ignore invalid URLs
        }
      });
    }
    document.addEventListener('DOMContentLoaded', highlightActiveNav);
    highlightActiveNav();
    
    window.addEventListener('scroll', function() {
      const btn = document.getElementById('back-to-top');
      if (window.scrollY > 300) {
        btn.classList.remove('opacity-0', 'invisible');
        btn.classList.add('opacity-100', 'visible');
      } else {
        btn.classList.add('opacity-0', 'invisible');
        btn.classList.remove('opacity-100', 'visible');
      }
    });
    
    document.querySelectorAll('[role="alert"] > div').forEach(function(alert) {
      setTimeout(function() {
        alert.style.opacity = '0';
        setTimeout(function() { alert.remove(); }, 300);
      }, 5000);
    });

    // Real-time course updates via WebSocket (optional Redis-backed Channels)
    (function() {
      const wsScheme = window.location.protocol === 'https:' ? 'wss' : 'ws';
      const wsUrl = `${wsScheme}://${window.location.host}/ws/courses/`;

      let courseSocket = null;
      let reconnectAttempts = 0;
      const maxReconnectAttempts = 5;
      const reconnectDelayMs = 3000;

      function connectCourseWebSocket() {
        try {
          courseSocket = new WebSocket(wsUrl);

          courseSocket.onopen = function() {
            reconnectAttempts = 0;
          };

          courseSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            const { type, course } = data;

            switch (type) {
              case 'course_created':
              case 'course_updated':
                refreshCourses();
                showCourseNotification(course.title || course.slug, type === 'course_created' ? 'New course available' : 'Course updated', 'info');
                break;
              case 'course_deleted':
                refreshCourses();
                showCourseNotification(course.slug, 'Course removed', 'warning');
                break;
              default:
                break;
            }
          };

          courseSocket.onerror = function() {
            // Errors are handled by onclose reconnect
          };

          courseSocket.onclose = function() {
            if (reconnectAttempts < maxReconnectAttempts) {
              reconnectAttempts += 1;
              const delay = reconnectDelayMs * Math.pow(2, reconnectAttempts - 1);
              setTimeout(connectCourseWebSocket, delay);
            }
          };
        } catch (err) {
          console.error('WebSocket connection failed', err);
        }
      }

      function refreshCourses() {
        if (typeof loadCoursesDropdown === 'function') {
          loadCoursesDropdown();
        }
        if (typeof loadCoursesBar === 'function') {
          loadCoursesBar();
        }
      }

      function showCourseNotification(title, message, type) {
        const container = document.createElement('div');
        container.className = 'fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg text-white text-sm animate-fade-in';

        let bg = 'bg-blue-500';
        if (type === 'warning') bg = 'bg-yellow-500';
        if (type === 'error') bg = 'bg-red-600';

        container.classList.add(bg);
        container.innerHTML = `
          <div class="flex items-center gap-2">
            <span class="font-semibold">${message}</span>
            <span class="opacity-90">${title}</span>
          </div>
        `;

        document.body.appendChild(container);
        setTimeout(() => {
          container.style.opacity = '0';
          setTimeout(() => container.remove(), 400);
        }, 4000);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', connectCourseWebSocket);
      } else {
        connectCourseWebSocket();
      }

      window.addEventListener('beforeunload', function() {
        if (courseSocket && courseSocket.readyState === WebSocket.OPEN) {
          courseSocket.close();
        }
      });
    })();

    // Auto-refresh content every 30 seconds if no WebSocket (fallback polling)
    (function() {
      setInterval(function() {
        if (typeof loadCoursesDropdown === 'function') {
          loadCoursesDropdown();
        }
        if (typeof loadCoursesBar === 'function') {
          loadCoursesBar();
        }
      }, 30000);
    })();
  </script>
  
  {% block extra_js %}{% endblock %}
</body>
</html>
